<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cucina Autentica - Ristorante</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5D4037;
            --primary-dark: #3E2723;
            --secondary: #D4A574;
            --accent: #8D6E63;
            --beige: #F5F1EB;
            --beige-dark: #E8E0D5;
            --gray: #757575;
            --gray-light: #9E9E9E;
            --dark: #2C2C2C;
            --white: #FFFFFF;
            --success: #6B8E23;
            --error: #C62828;
            --gradient-brown: linear-gradient(135deg, #5D4037, #3E2723);
            --gradient-gold: linear-gradient(135deg, #D4A574, #B8956C);
            --radius: 16px;
            --radius-sm: 10px;
            --shadow: 0 4px 20px rgba(93, 64, 55, 0.15);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Lato', sans-serif;
            background: var(--beige);
            color: var(--dark);
            min-height: 100vh;
            padding-bottom: calc(70px + var(--safe-bottom));
            -webkit-font-smoothing: antialiased;
        }
        
        /* Typography */
        h1, h2, h3, .brand-title {
            font-family: 'Playfair Display', serif;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: var(--white);
            padding: calc(12px + var(--safe-top)) 20px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }
        .header-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header-logo img {
            height: 45px;
        }
        .header-brand {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
        }
        .header-brand span {
            color: var(--secondary);
        }
        .header-btn {
            padding: 10px 20px;
            background: var(--gradient-brown);
            border: none;
            border-radius: 25px;
            color: var(--white);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
        }
        
        /* Main Content */
        .main-content {
            padding-top: calc(75px + var(--safe-top));
        }
        .page { display: none; }
        .page.active { display: block; }
        
        /* Hero Section */
        .hero {
            background: var(--gradient-brown);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }
        .hero-content {
            position: relative;
            z-index: 1;
        }
        .hero-subtitle {
            font-family: 'Lato', sans-serif;
            font-size: 12px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--secondary);
            margin-bottom: 8px;
        }
        .hero-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: var(--white);
            margin-bottom: 8px;
        }
        .hero-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 20px;
        }
        .hero-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .hero-btn {
            padding: 14px 28px;
            border-radius: 30px;
            font-family: 'Lato', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 2px solid var(--secondary);
            transition: all 0.3s;
        }
        .hero-btn.primary {
            background: var(--secondary);
            color: var(--primary-dark);
        }
        .hero-btn.secondary {
            background: transparent;
            color: var(--white);
        }
        
        /* Section Titles */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 20px 16px;
        }
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            color: var(--primary);
        }
        .section-link {
            font-size: 13px;
            color: var(--secondary);
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Categories */
        .categories-scroll {
            display: flex;
            gap: 12px;
            padding: 0 20px 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .categories-scroll::-webkit-scrollbar { display: none; }
        .category-card {
            flex-shrink: 0;
            width: 85px;
            padding: 16px 10px;
            background: var(--white);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 2px solid transparent;
        }
        .category-card.active {
            border-color: var(--primary);
            background: var(--beige-dark);
        }
        .category-card span:first-child {
            font-size: 32px;
            display: block;
            margin-bottom: 8px;
        }
        .category-card span:last-child {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Product Cards */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 0 20px 20px;
        }
        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        .product-card:active {
            transform: scale(0.98);
        }
        .product-image {
            width: 100%;
            height: 120px;
            background: var(--beige-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            overflow: hidden;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-info {
            padding: 14px;
        }
        .product-name {
            font-family: 'Playfair Display', serif;
            font-size: 15px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }
        .product-price {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
        }
        .product-unavailable {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* Menu Page */
        .menu-header {
            background: var(--white);
            padding: 16px 20px;
            position: sticky;
            top: calc(69px + var(--safe-top));
            z-index: 50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .menu-categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .menu-categories::-webkit-scrollbar { display: none; }
        .menu-cat-btn {
            flex-shrink: 0;
            padding: 10px 20px;
            background: var(--beige);
            border: none;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
        }
        .menu-cat-btn.active {
            background: var(--primary);
            color: var(--white);
        }
        
        /* Bottom Sheet */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 24px 24px 0 0;
            z-index: 201;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            max-height: 85vh;
            overflow-y: auto;
        }
        .bottom-sheet.active {
            transform: translateY(0);
        }
        .sheet-handle {
            width: 40px;
            height: 4px;
            background: var(--beige-dark);
            border-radius: 2px;
            margin: 12px auto;
        }
        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 16px;
            border-bottom: 1px solid var(--beige-dark);
        }
        .sheet-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--primary);
        }
        .sheet-close {
            width: 36px;
            height: 36px;
            background: var(--beige);
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray);
        }
        .sheet-content {
            padding: 20px;
            padding-bottom: calc(100px + var(--safe-bottom));
        }
        
        /* Product Detail */
        .product-detail-image {
            width: 100%;
            height: 200px;
            background: var(--beige-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            overflow: hidden;
        }
        .product-detail-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-detail-name {
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            color: var(--dark);
            margin-bottom: 8px;
        }
        .product-detail-desc {
            font-size: 14px;
            color: var(--gray);
            line-height: 1.6;
            margin-bottom: 24px;
        }
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
        }
        .qty-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            background: transparent;
            font-size: 24px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .qty-btn:active {
            background: var(--primary);
            color: var(--white);
        }
        .qty-value {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }
        .add-to-cart-btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient-brown);
            border: none;
            border-radius: 30px;
            color: var(--white);
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }
        .add-to-cart-btn:active {
            transform: scale(0.98);
        }
        
        /* Cart */
        .cart-empty {
            text-align: center;
            padding: 60px 20px;
        }
        .cart-empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        .cart-empty h2 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .cart-empty p {
            color: var(--gray);
            margin-bottom: 24px;
        }
        .cart-item {
            display: flex;
            gap: 14px;
            padding: 16px 0;
            border-bottom: 1px solid var(--beige-dark);
        }
        .cart-item-image {
            width: 75px;
            height: 75px;
            background: var(--beige-dark);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
            overflow: hidden;
        }
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-name {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .cart-item-price {
            font-size: 14px;
            color: var(--primary);
            font-weight: 600;
        }
        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }
        .cart-qty-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--beige-dark);
            background: var(--white);
            font-size: 16px;
            cursor: pointer;
            color: var(--primary);
        }
        .cart-item-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-between;
        }
        .cart-remove-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.5;
        }
        .cart-summary {
            background: var(--beige);
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
        }
        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .cart-summary-row:last-child {
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid var(--beige-dark);
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            font-weight: 600;
        }
        .checkout-btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient-brown);
            border: none;
            border-radius: 30px;
            color: var(--white);
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            cursor: pointer;
        }
        
        /* Loyalty Page */
        .loyalty-header {
            background: var(--gradient-brown);
            padding: 30px 20px;
            text-align: center;
            color: var(--white);
        }
        .points-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--white);
            margin: 0 auto 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .points-value {
            font-family: 'Playfair Display', serif;
            font-size: 42px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }
        .points-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .rewards-section {
            padding: 20px;
        }
        .reward-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .reward-icon {
            width: 55px;
            height: 55px;
            background: var(--beige);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        .reward-info {
            flex: 1;
        }
        .reward-name {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .reward-points {
            font-size: 13px;
            color: var(--secondary);
            font-weight: 600;
        }
        .reward-btn {
            padding: 10px 20px;
            background: var(--gradient-gold);
            border: none;
            border-radius: 20px;
            color: var(--primary-dark);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
        .reward-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        /* Profile Page */
        .profile-header {
            background: var(--gradient-brown);
            padding: 40px 20px;
            text-align: center;
            color: var(--white);
        }
        .profile-avatar {
            width: 90px;
            height: 90px;
            background: var(--secondary);
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 4px solid var(--white);
        }
        .profile-name {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 4px;
        }
        .profile-email {
            font-size: 14px;
            opacity: 0.8;
        }
        .profile-menu {
            padding: 20px;
        }
        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px;
            background: var(--white);
            border-radius: var(--radius);
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        .profile-menu-item:active {
            transform: scale(0.98);
        }
        .profile-menu-icon {
            width: 45px;
            height: 45px;
            background: var(--beige);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        .profile-menu-text {
            flex: 1;
            font-weight: 500;
        }
        .profile-menu-arrow {
            color: var(--gray-light);
        }
        
        /* Auth Forms */
        .auth-page {
            padding: 40px 20px;
            text-align: center;
        }
        .auth-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .auth-subtitle {
            color: var(--gray);
            margin-bottom: 32px;
        }
        .form-group {
            margin-bottom: 16px;
            text-align: left;
        }
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--beige-dark);
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            transition: border-color 0.2s;
            background: var(--white);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .auth-btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient-brown);
            border: none;
            border-radius: 30px;
            color: var(--white);
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            cursor: pointer;
            margin-top: 8px;
        }
        .auth-link {
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray);
        }
        .auth-link a {
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 8px 0 calc(8px + var(--safe-bottom));
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 4px 10px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 10px;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: var(--primary);
        }
        .nav-item svg {
            width: 22px;
            height: 22px;
        }
        .nav-item.order-btn {
            padding: 0;
        }
        .nav-item-order {
            position: relative;
            top: -15px;
            width: 70px;
            padding: 12px 8px 10px;
            background: var(--secondary);
            border-radius: 16px 16px 12px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            box-shadow: 0 4px 15px rgba(212, 165, 116, 0.5);
            transition: transform 0.2s;
        }
        .nav-item-order:active {
            transform: scale(0.95);
        }
        .nav-item-order svg {
            width: 26px;
            height: 26px;
            color: var(--white);
            stroke-width: 2.5;
            margin-left: -3px;
        }
        .nav-item-order span {
            font-size: 9px;
            font-weight: 700;
            color: var(--white);
            letter-spacing: 0.3px;
        }
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error);
            color: var(--white);
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(198, 40, 40, 0.4);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--primary);
            color: var(--white);
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 999;
            opacity: 0;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--error); }
        
        /* QR Code */
        .qr-container {
            background: var(--white);
            padding: 24px;
            border-radius: var(--radius);
            display: inline-block;
            box-shadow: var(--shadow);
        }
        .qr-code-text {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 16px;
        }
        
        /* Decorative */
        .divider {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 24px 0;
            color: var(--gray-light);
            font-size: 13px;
        }
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--beige-dark);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-logo">
            <img src="images/logo.png" alt="Cucina Autentica">
        </div>
        <button class="header-btn" id="headerAuthBtn" onclick="showPage('login')">Connexion</button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- HOME PAGE -->
        <div id="homePage" class="page active">
            <section class="hero">
                <div class="hero-content">
                    <p class="hero-subtitle">Benvenuto a</p>
                    <h1 class="hero-title">Cucina Autentica</h1>
                    <p class="hero-desc">Savourez l'authenticit√© de la cuisine italienne</p>
                    <div class="hero-buttons">
                        <button class="hero-btn primary" onclick="showPage('menu')">Voir la Carta</button>
                        <button class="hero-btn secondary" onclick="showPage('order')">Commander</button>
                    </div>
                </div>
            </section>
            
            <div class="section-header">
                <h2 class="section-title">Cat√©gories</h2>
            </div>
            <div id="homeCategories" class="categories-scroll"></div>
            
            <div class="section-header">
                <h2 class="section-title">Nos Sp√©cialit√©s</h2>
                <a href="#" class="section-link" onclick="showPage('menu');return false;">Voir tout ‚Üí</a>
            </div>
            <div id="popularProducts" class="products-grid"></div>
        </div>
        
        <!-- MENU PAGE -->
        <div id="menuPage" class="page">
            <div class="menu-header">
                <div id="menuCategories" class="menu-categories"></div>
            </div>
            <div class="section-header">
                <h2 class="section-title">La Carta</h2>
            </div>
            <div id="menuProducts" class="products-grid"></div>
        </div>
        
        <!-- ORDER PAGE -->
        <div id="orderPage" class="page">
            <div class="sheet-header" style="padding:20px;border:none;">
                <h2 class="sheet-title">Votre Commande</h2>
            </div>
            <div id="orderContent"></div>
        </div>
        
        <!-- LOYALTY PAGE -->
        <div id="loyaltyPage" class="page">
            <div class="loyalty-header">
                <div class="points-circle">
                    <span id="userPoints" class="points-value">0</span>
                    <span class="points-label">Points</span>
                </div>
                <p style="opacity:0.8">Cumulez des points √† chaque commande</p>
            </div>
            <div class="rewards-section">
                <h3 class="section-title" style="margin-bottom:16px;">R√©compenses</h3>
                <div id="rewardsList"></div>
            </div>
        </div>
        
        <!-- PROFILE PAGE -->
        <div id="profilePage" class="page">
            <div id="profileContent"></div>
        </div>
        
        <!-- LOGIN PAGE -->
        <div id="loginPage" class="page">
            <div class="auth-page">
                <h1 class="auth-title">Bentornato!</h1>
                <p class="auth-subtitle">Connectez-vous pour commander</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="votre@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mot de passe</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="auth-btn">Connexion</button>
                </form>
                <p class="auth-link">Pas encore de compte? <a href="#" onclick="showPage('register');return false;">S'inscrire</a></p>
            </div>
        </div>
        
        <!-- REGISTER PAGE -->
        <div id="registerPage" class="page">
            <div class="auth-page">
                <h1 class="auth-title">Benvenuto!</h1>
                <p class="auth-subtitle">Cr√©ez votre compte fid√©lit√©</p>
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" id="regName" placeholder="Mario Rossi" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="regEmail" placeholder="votre@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">T√©l√©phone</label>
                        <input type="tel" class="form-input" id="regPhone" placeholder="0470 00 00 00" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mot de passe</label>
                        <input type="password" class="form-input" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="auth-btn">Cr√©er mon compte</button>
                </form>
                <p class="auth-link">D√©j√† un compte? <a href="#" onclick="showPage('login');return false;">Connexion</a></p>
            </div>
        </div>
        
        <!-- CHECKOUT PAGE -->
        <div id="checkoutPage" class="page">
            <div class="sheet-header" style="padding:20px;border:none;">
                <h2 class="sheet-title">Finaliser</h2>
            </div>
            <div id="checkoutContent" style="padding:0 20px 20px;"></div>
        </div>
        
        <!-- CONFIRMATION PAGE -->
        <div id="confirmationPage" class="page">
            <div id="confirmationContent" style="padding:40px 20px;text-align:center;"></div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="showPage('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span>Accueil</span>
        </button>
        <button class="nav-item" onclick="showPage('menu')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            <span>Menu</span>
        </button>
        <button class="nav-item order-btn" onclick="showPage('order')">
            <div class="nav-item-order">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                <span>Commander</span>
                <span id="cartBadge" class="cart-badge" style="display:none;">0</span>
            </div>
        </button>
        <button class="nav-item" onclick="showPage('loyalty')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
            <span>Fid√©lit√©</span>
        </button>
        <button class="nav-item" onclick="showPage('profile')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>Profil</span>
        </button>
    </nav>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>
    
    <!-- Product Detail Sheet -->
    <div id="productSheet" class="bottom-sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header">
            <h3 class="sheet-title">D√©tails</h3>
            <button class="sheet-close" onclick="closeModal()">‚úï</button>
        </div>
        <div id="productSheetContent" class="sheet-content"></div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
// ========== CONFIGURATION ==========
const API_URL = 'https://italian-restaurant-api.vercel.app/api';

// ========== STATE ==========
const state = {
    user: null,
    categories: [],
    products: [],
    rewards: [],
    cart: [],
    orders: [],
    userRewards: [],
    currentCategory: null,
    selectedOrderType: 'click-collect',
    selectedPickupTime: null
};

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', () => {
    loadState();
    init();
    
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('registerForm').addEventListener('submit', handleRegister);
});

async function init() {
    await loadCategories();
    await loadProducts();
    await loadRewards();
    if (state.user) {
        await refreshUser();
        await loadUserRewards();
        await loadUserOrders();
    }
    renderAll();
}

// ========== LOCAL STORAGE ==========
function loadState() {
    const savedUser = localStorage.getItem('it_user');
    const savedCart = localStorage.getItem('it_cart');
    if (savedUser) state.user = JSON.parse(savedUser);
    if (savedCart) state.cart = JSON.parse(savedCart);
    updateAuthUI();
    updateCartBadge();
}

function saveUser() {
    if (state.user) localStorage.setItem('it_user', JSON.stringify(state.user));
    else localStorage.removeItem('it_user');
}

function saveCart() {
    localStorage.setItem('it_cart', JSON.stringify(state.cart));
    updateCartBadge();
}

// ========== API CALLS ==========
async function apiCall(endpoint, options = {}) {
    try {
        const response = await fetch(API_URL + endpoint, {
            headers: { 'Content-Type': 'application/json' },
            ...options
        });
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        return null;
    }
}

async function loadCategories() {
    const cats = await apiCall('/categories');
    if (cats) state.categories = cats;
}

async function loadProducts(cid = null) {
    const p = await apiCall(cid ? `/products?categoryId=${cid}` : '/products');
    if (p) state.products = p;
}

async function loadRewards() {
    const r = await apiCall('/rewards');
    if (r) state.rewards = r;
}

async function loadUserRewards() {
    if (!state.user) return;
    const r = await apiCall(`/users/${state.user.id}/rewards`);
    if (r) state.userRewards = r;
}

async function loadUserOrders() {
    if (!state.user) return;
    const o = await apiCall(`/users/${state.user.id}/orders`);
    if (o) state.orders = o;
}

async function refreshUser() {
    if (!state.user) return;
    const u = await apiCall(`/users/${state.user.id}`);
    if (u) { state.user = u; saveUser(); }
}

// ========== RENDERING ==========
function renderAll() {
    renderCategories();
    renderPopularProducts();
    renderMenuProducts();
    renderRewards();
    renderProfile();
    renderOrder();
    updateCartBadge();
}

function renderCategories() {
    const c = document.getElementById('homeCategories');
    const m = document.getElementById('menuCategories');
    
    const all = `<button class="menu-cat-btn ${!state.currentCategory ? 'active' : ''}" onclick="selectCategory(null)">Tutti</button>`;
    
    const homeHtml = state.categories.map(cat => `
        <div class="category-card ${state.currentCategory === cat.id ? 'active' : ''}" onclick="selectCategory(${cat.id})">
            <span>${cat.icon}</span>
            <span>${cat.name}</span>
        </div>
    `).join('');
    
    const menuHtml = state.categories.map(cat => `
        <button class="menu-cat-btn ${state.currentCategory === cat.id ? 'active' : ''}" onclick="selectCategory(${cat.id})">${cat.name}</button>
    `).join('');
    
    c.innerHTML = homeHtml;
    m.innerHTML = all + menuHtml;
}

async function selectCategory(cid) {
    state.currentCategory = cid;
    renderCategories();
    await loadProducts(cid);
    renderMenuProducts();
    showPage('menu');
}

function getEmoji(cid) {
    const c = state.categories.find(x => x.id === cid);
    return c ? c.icon : 'üçù';
}

// Images des plats (√† compl√©ter)
const productImages = {};

function getProductImage(p) {
    if (productImages[p.name]) {
        return `<img src="${productImages[p.name]}" alt="${p.name}">`;
    }
    return getEmoji(p.categoryId);
}

function renderProductCard(p) {
    const imgContent = productImages[p.name] 
        ? `<img src="${productImages[p.name]}" alt="${p.name}">`
        : getEmoji(p.categoryId);
    return `
        <div class="product-card ${!p.available ? 'product-unavailable' : ''}" onclick="openProductDetail(${p.id})">
            <div class="product-image">${imgContent}</div>
            <div class="product-info">
                <div class="product-name">${p.name}</div>
                <div class="product-price">${p.price.toFixed(2)}‚Ç¨</div>
            </div>
        </div>
    `;
}

function renderPopularProducts() {
    document.getElementById('popularProducts').innerHTML = state.products.filter(p => p.available).slice(0, 6).map(p => renderProductCard(p)).join('');
}

function renderMenuProducts() {
    const f = state.currentCategory ? state.products.filter(p => p.categoryId === state.currentCategory) : state.products;
    document.getElementById('menuProducts').innerHTML = f.map(p => renderProductCard(p)).join('');
}

function openProductDetail(pid) {
    const p = state.products.find(x => x.id === pid);
    if (!p || !p.available) return;
    
    const imgContent = productImages[p.name] 
        ? `<img src="${productImages[p.name]}" alt="${p.name}">`
        : getEmoji(p.categoryId);
    
    document.getElementById('productSheetContent').innerHTML = `
        <div class="product-detail-image">${imgContent}</div>
        <h2 class="product-detail-name">${p.name}</h2>
        <p class="product-detail-desc">${p.description}</p>
        <div class="quantity-selector">
            <button class="qty-btn" onclick="updateQty(-1)">‚àí</button>
            <span id="qtyValue" class="qty-value">1</span>
            <button class="qty-btn" onclick="updateQty(1)">+</button>
        </div>
        <button class="add-to-cart-btn" onclick="addToCart(${p.id})">
            <span>Ajouter</span>
            <span id="addToCartPrice">${p.price.toFixed(2)}‚Ç¨</span>
        </button>
    `;
    document.getElementById('productSheet').dataset.productId = pid;
    document.getElementById('productSheet').dataset.price = p.price;
    openModal('productSheet');
}

function updateQty(d) {
    const q = document.getElementById('qtyValue');
    const pr = document.getElementById('addToCartPrice');
    const s = document.getElementById('productSheet');
    const price = parseFloat(s.dataset.price);
    let qty = parseInt(q.textContent) + d;
    if (qty < 1) qty = 1;
    if (qty > 10) qty = 10;
    q.textContent = qty;
    pr.textContent = (price * qty).toFixed(2) + '‚Ç¨';
}

function addToCart(pid) {
    const p = state.products.find(x => x.id === pid);
    const qty = parseInt(document.getElementById('qtyValue').textContent);
    const ex = state.cart.find(i => i.productId === pid);
    if (ex) ex.quantity += qty;
    else state.cart.push({ productId: p.id, name: p.name, price: p.price, categoryId: p.categoryId, quantity: qty });
    saveCart();
    closeModal();
    showToast(`${qty}x ${p.name} ajout√©`, 'success');
}

// ========== CART / ORDER ==========
function renderOrder() {
    const c = document.getElementById('orderContent');
    
    if (!state.cart.length) {
        c.innerHTML = `
            <div class="cart-empty">
                <div class="cart-empty-icon">üçù</div>
                <h2>Votre panier est vide</h2>
                <p>D√©couvrez nos sp√©cialit√©s italiennes</p>
                <button class="checkout-btn" onclick="showPage('menu')">Voir le Menu</button>
            </div>
        `;
        return;
    }
    
    const items = state.cart.map((i, idx) => {
        const imgContent = productImages[i.name] 
            ? `<img src="${productImages[i.name]}" alt="${i.name}">`
            : getEmoji(i.categoryId);
        return `
            <div class="cart-item">
                <div class="cart-item-image">${imgContent}</div>
                <div class="cart-item-info">
                    <div class="cart-item-name">${i.name}</div>
                    <div class="cart-item-price">${i.price.toFixed(2)}‚Ç¨</div>
                    <div class="cart-item-qty">
                        <button class="cart-qty-btn" onclick="updateCartQty(${idx}, -1)">‚àí</button>
                        <span>${i.quantity}</span>
                        <button class="cart-qty-btn" onclick="updateCartQty(${idx}, 1)">+</button>
                    </div>
                </div>
                <div class="cart-item-actions">
                    <button class="cart-remove-btn" onclick="removeFromCart(${idx})">üóë</button>
                    <span style="font-weight:600">${(i.price * i.quantity).toFixed(2)}‚Ç¨</span>
                </div>
            </div>
        `;
    }).join('');
    
    const sub = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
    const pts = Math.floor(sub * 4);
    
    c.innerHTML = `
        <div style="padding:0 20px">
            ${items}
            <div class="cart-summary">
                <div class="cart-summary-row"><span>Sous-total</span><span>${sub.toFixed(2)}‚Ç¨</span></div>
                ${state.user ? `<div class="cart-summary-row"><span>Points √† gagner</span><span style="color:var(--secondary)">+${pts}</span></div>` : ''}
                <div class="cart-summary-row"><span>Total</span><span>${sub.toFixed(2)}‚Ç¨</span></div>
            </div>
            <button class="checkout-btn" onclick="showPage('checkout')">Commander</button>
        </div>
    `;
}

function updateCartQty(idx, d) {
    state.cart[idx].quantity += d;
    if (state.cart[idx].quantity < 1) state.cart.splice(idx, 1);
    saveCart();
    renderOrder();
}

function removeFromCart(idx) {
    state.cart.splice(idx, 1);
    saveCart();
    renderOrder();
    showToast('Produit retir√©', 'success');
}

function updateCartBadge() {
    const badge = document.getElementById('cartBadge');
    const count = state.cart.reduce((s, i) => s + i.quantity, 0);
    badge.textContent = count;
    badge.style.display = count > 0 ? 'block' : 'none';
}

// ========== REWARDS ==========
function renderRewards() {
    document.getElementById('userPoints').textContent = state.user ? state.user.points : 0;
    const rewardEmojis = { drink: 'üç∑', side: 'ü•ó', dessert: 'üç∞', pasta: 'üçù', menu: 'üéÅ' };
    
    document.getElementById('rewardsList').innerHTML = state.rewards.map(r => `
        <div class="reward-card">
            <div class="reward-icon">${rewardEmojis[r.type] || 'üéÅ'}</div>
            <div class="reward-info">
                <div class="reward-name">${r.name}</div>
                <div class="reward-points">${r.pointsCost} points</div>
            </div>
            <button class="reward-btn" ${!state.user || state.user.points < r.pointsCost ? 'disabled' : ''} onclick="redeemReward(${r.id})">√âchanger</button>
        </div>
    `).join('');
}

async function redeemReward(rid) {
    if (!state.user) { showPage('login'); return; }
    const r = await apiCall('/rewards/redeem', {
        method: 'POST',
        body: JSON.stringify({ userId: state.user.id, rewardId: rid })
    });
    if (r && r.success) {
        await refreshUser();
        renderRewards();
        showToast('R√©compense obtenue!', 'success');
    } else {
        showToast('Erreur', 'error');
    }
}

// ========== PROFILE ==========
function renderProfile() {
    const c = document.getElementById('profileContent');
    
    if (!state.user) {
        c.innerHTML = `
            <div class="auth-page">
                <h1 class="auth-title">Mon Compte</h1>
                <p class="auth-subtitle">Connectez-vous pour acc√©der √† votre profil</p>
                <button class="auth-btn" onclick="showPage('login')">Connexion</button>
                <p class="auth-link">Pas encore de compte? <a href="#" onclick="showPage('register');return false;">S'inscrire</a></p>
            </div>
        `;
        return;
    }
    
    c.innerHTML = `
        <div class="profile-header">
            <div class="profile-avatar">üë§</div>
            <h2 class="profile-name">${state.user.name}</h2>
            <p class="profile-email">${state.user.email}</p>
        </div>
        <div class="profile-menu">
            <div class="profile-menu-item" onclick="showOrders()">
                <div class="profile-menu-icon">üìã</div>
                <span class="profile-menu-text">Mes commandes</span>
                <span class="profile-menu-arrow">‚Ä∫</span>
            </div>
            <div class="profile-menu-item" onclick="showPage('loyalty')">
                <div class="profile-menu-icon">‚≠ê</div>
                <span class="profile-menu-text">Programme fid√©lit√©</span>
                <span class="profile-menu-arrow">‚Ä∫</span>
            </div>
            <div class="profile-menu-item" onclick="logout()">
                <div class="profile-menu-icon">üö™</div>
                <span class="profile-menu-text">D√©connexion</span>
                <span class="profile-menu-arrow">‚Ä∫</span>
            </div>
        </div>
    `;
}

// ========== AUTH ==========
async function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    const r = await apiCall('/auth/login', {
        method: 'POST',
        body: JSON.stringify({ email, password })
    });
    
    if (r && r.success) {
        state.user = r.user;
        saveUser();
        updateAuthUI();
        await loadUserRewards();
        await loadUserOrders();
        renderAll();
        showPage('home');
        showToast('Bentornato!', 'success');
    } else {
        showToast('Identifiants incorrects', 'error');
    }
}

async function handleRegister(e) {
    e.preventDefault();
    const name = document.getElementById('regName').value;
    const email = document.getElementById('regEmail').value;
    const phone = document.getElementById('regPhone').value;
    const password = document.getElementById('regPassword').value;
    
    const r = await apiCall('/auth/register', {
        method: 'POST',
        body: JSON.stringify({ name, email, phone, password })
    });
    
    if (r && r.success) {
        state.user = r.user;
        saveUser();
        updateAuthUI();
        renderAll();
        showPage('home');
        showToast('Benvenuto!', 'success');
    } else {
        showToast(r?.error || 'Erreur', 'error');
    }
}

function logout() {
    state.user = null;
    state.orders = [];
    state.userRewards = [];
    saveUser();
    updateAuthUI();
    renderAll();
    showPage('home');
    showToast('Arrivederci!', 'success');
}

function updateAuthUI() {
    const btn = document.getElementById('headerAuthBtn');
    if (state.user) {
        btn.textContent = state.user.name.split(' ')[0];
        btn.onclick = () => showPage('profile');
    } else {
        btn.textContent = 'Connexion';
        btn.onclick = () => showPage('login');
    }
}

// ========== CHECKOUT ==========
function renderCheckout() {
    const c = document.getElementById('checkoutContent');
    const sub = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
    const pts = Math.floor(sub * 4);
    
    // Generate pickup times
    const times = [];
    const now = new Date();
    let start = new Date(now);
    start.setMinutes(Math.ceil(start.getMinutes() / 15) * 15 + 15);
    for (let i = 0; i < 6; i++) {
        times.push(start.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }));
        start.setMinutes(start.getMinutes() + 15);
    }
    state.selectedPickupTime = times[0];
    
    c.innerHTML = `
        <h3 style="font-family:'Playfair Display',serif;margin-bottom:16px;">Type de commande</h3>
        <div style="display:flex;gap:12px;margin-bottom:24px;">
            <button class="hero-btn primary" style="flex:1;padding:16px;" onclick="selectOrderType(this,'click-collect')">
                <div>üèÉ Click & Collect</div>
            </button>
            <button class="hero-btn secondary" style="flex:1;padding:16px;border-color:var(--beige-dark);color:var(--gray);" onclick="selectOrderType(this,'sur-place')">
                <div>üçΩ Sur place</div>
            </button>
        </div>
        
        <div id="pickupContainer">
            <h3 style="font-family:'Playfair Display',serif;margin-bottom:16px;">Heure de retrait</h3>
            <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:24px;">
                ${times.map((t, i) => `<button class="menu-cat-btn ${i === 0 ? 'active' : ''}" onclick="selectPickupTime(this,'${t}')">${t}</button>`).join('')}
            </div>
        </div>
        
        ${!state.user ? `
            <div style="background:var(--beige);padding:16px;border-radius:var(--radius);margin-bottom:20px;">
                <p style="font-size:14px;margin-bottom:12px;"><strong>Connectez-vous</strong> pour gagner ${pts} points!</p>
                <button class="auth-btn" style="padding:12px;" onclick="showPage('login')">Se connecter</button>
            </div>
        ` : ''}
        
        <div class="cart-summary">
            <div class="cart-summary-row"><span>Total</span><span>${sub.toFixed(2)}‚Ç¨</span></div>
            ${state.user ? `<div class="cart-summary-row"><span>Points</span><span style="color:var(--secondary)">+${pts} pts</span></div>` : ''}
        </div>
        <button class="checkout-btn" onclick="placeOrder()">Confirmer la commande</button>
    `;
}

function selectOrderType(el, type) {
    state.selectedOrderType = type;
    document.querySelectorAll('#checkoutContent .hero-btn').forEach(b => {
        b.classList.remove('primary', 'secondary');
        b.classList.add('secondary');
        b.style.borderColor = 'var(--beige-dark)';
        b.style.color = 'var(--gray)';
    });
    el.classList.remove('secondary');
    el.classList.add('primary');
    el.style.borderColor = 'var(--secondary)';
    el.style.color = 'var(--primary-dark)';
    
    document.getElementById('pickupContainer').style.display = type === 'click-collect' ? 'block' : 'none';
}

function selectPickupTime(el, time) {
    state.selectedPickupTime = time;
    document.querySelectorAll('#pickupContainer .menu-cat-btn').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
}

async function placeOrder() {
    const sub = state.cart.reduce((s, i) => s + (i.price * i.quantity), 0);
    const pts = Math.floor(sub * 4);
    
    const now = new Date();
    const dateStr = now.toISOString().slice(2, 10).replace(/-/g, '');
    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    const orderCode = `IT-${dateStr}-${random}`;
    
    const newOrder = {
        id: Date.now(),
        orderCode: orderCode,
        userId: state.user ? state.user.id : null,
        userName: state.user ? state.user.name : 'Client',
        items: state.cart.map(i => ({ productId: i.productId, name: i.name, quantity: i.quantity, price: i.price })),
        subtotal: sub,
        total: sub,
        pointsEarned: pts,
        type: state.selectedOrderType,
        pickupTime: state.selectedOrderType === 'click-collect' ? state.selectedPickupTime : null,
        status: 'pending',
        createdAt: now.toISOString()
    };
    
    // Save to localStorage
    let allOrders = JSON.parse(localStorage.getItem('it_orders') || '[]');
    allOrders.push(newOrder);
    localStorage.setItem('it_orders', JSON.stringify(allOrders));
    
    state.cart = [];
    saveCart();
    renderConfirmation(newOrder);
    showPage('confirmation');
    showToast('Ordine confermato!', 'success');
}

function renderConfirmation(o) {
    document.getElementById('confirmationContent').innerHTML = `
        <div style="font-size:64px;margin-bottom:20px">‚úÖ</div>
        <h2 style="font-family:'Playfair Display',serif;font-size:28px;margin-bottom:8px">Grazie!</h2>
        <p style="color:var(--gray);margin-bottom:24px">Pr√©sentez ce QR code au comptoir</p>
        <div class="qr-container">
            <div id="confirmQR"></div>
            <div class="qr-code-text">${o.orderCode}</div>
        </div>
        <div style="background:var(--beige);padding:16px;border-radius:var(--radius);text-align:left;margin-top:24px">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px"><span>Total</span><strong>${o.total.toFixed(2)}‚Ç¨</strong></div>
            ${state.user ? `<div style="display:flex;justify-content:space-between;color:var(--secondary)"><span>Points gagn√©s</span><strong>+${o.pointsEarned}</strong></div>` : ''}
        </div>
        <p style="margin-top:16px;color:var(--gray);font-size:14px">${o.type === 'click-collect' ? `Retrait √† <strong>${o.pickupTime}</strong>` : 'Sur place'}</p>
        <button class="checkout-btn" style="margin-top:24px" onclick="showPage('home')">Retour √† l'accueil</button>
    `;
    
    setTimeout(() => {
        const qr = document.getElementById('confirmQR');
        if (qr) {
            qr.innerHTML = '';
            new QRCode(qr, { text: o.orderCode, width: 180, height: 180, colorDark: '#5D4037', colorLight: '#FFF' });
        }
    }, 100);
}

function showOrders() {
    showToast('Fonctionnalit√© √† venir', 'success');
}

// ========== NAVIGATION ==========
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId + 'Page').classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const navMap = { home: 0, menu: 1, order: 2, loyalty: 3, profile: 4 };
    if (navMap[pageId] !== undefined) {
        document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
    }
    
    // Render specific pages
    if (pageId === 'checkout') renderCheckout();
    if (pageId === 'order') renderOrder();
    if (pageId === 'profile') renderProfile();
    
    window.scrollTo(0, 0);
}

function openModal(sheetId) {
    document.getElementById('modalOverlay').classList.add('active');
    document.getElementById(sheetId).classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
    document.querySelectorAll('.bottom-sheet').forEach(s => s.classList.remove('active'));
    document.body.style.overflow = '';
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast show ' + type;
    setTimeout(() => toast.className = 'toast', 3000);
}
    </script>
</body>
</html>
